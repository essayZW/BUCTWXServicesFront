function touchSliderPointer(a,b){var c,d;if(!b.getState().lock){c=b.selectComponent("#"+a.currentTarget.id);d=c.getDataset().type;b.getState()["canMoveSlider"+d]=!0;return!1}}function touchMoveSliderPointer(a,b){var d,e,f,g,h,i,j,k,l,m,p,q,r,s,t,u,v,c=b.getState();if(!c.lock){d=b.selectComponent("#"+a.currentTarget.id);e=d.getDataset().type;f=b.getState()["canMoveSlider"+e];if(f){g=c.lastColor;h=a.touches[0];i=getSliderDataset(b,e);d=b.selectComponent("#slider-pointer-"+e);j=d.getDataset().width;k=d.getDataset().height;l=i.rect;m=h.clientX;h.clientY;l.height;p=j;q={x:l.left-p,y:l.top-k/2};r={x:l.right+p,y:l.top-k/2};s={x:l.right-p,y:l.bottom+k/2};t={x:l.left+p,y:l.bottom+k/2};if(pointInTheRegion({x:h.clientX,y:h.clientY},q,r,s,t)){u=l.right-m;v=u/l.width;0>v&&(v=0);v>1&&(v=1);"s"==e?changeColorValue({h:g.h,s:v,v:g.v,t:g.t},b,!0):"v"==e?changeColorValue({h:g.h,s:g.s,v:v,t:g.t},b,!0):"t"==e&&changeColorValue({h:g.h,s:g.s,v:g.v,t:v},b,!0)}else b.getState()["canMoveSlider"+e]=!1;return!1}}}function updateSliderPointerPosition(a,b){var c=a.getState(),d=c.lastColor,e=d[b],f=a.selectComponent("#slider-pointer-"+b),g=a.selectComponent("#slider-"+b),h=f.getDataset().width,i=g.getDataset().rect,j=i.width-i.width*e;f.setStyle({left:j-h/2+"px !important"})}function tapRingPointer(a,b){var d,e,f,g,h,c=b.getState().lock;if(!c){d=a.touches[0];e=getCanvasDataset(b);f=d.clientX-e.containerRect.left;g=d.clientY-e.containerRect.top;h=inRingArea({x:f,y:g},b);if(h.in){b.getState().lock=!0;b.callMethod("lockEventTrigger");animationMoveRingPointer(h.angle,b)}}}function animationMoveRingPointer(a,b){function m(){var e=c.temp+i;c.temp=e;0>e&&(e+=360);e>360&&(e-=360);l++;if(l>h){changeColorValue({h:a,s:d.s,v:d.v,t:d.t},b,!1);b.getState().lock=!1;b.callMethod("unLockEventTrigger")}else{changeColorValue({h:e,s:d.s,v:d.v,t:d.t},b,!1);b.requestAnimationFrame(m)}}var c,d,e,f,g,h,i,j,k,l;0>a&&(a+=360);a>360&&(a-=360);c=b.getState();d=c.lastColor;e=d.h;f=getCanvasDataset(b);g=f.animationDuration;h=Math.floor(g/PFS);i=(a-e)/h;j=Math.abs(a-e);if(j>180){j-=360;k=j/h;0>i&&(k*=-1);i=k}l=0;c.temp=d.h;m()}function touchRingPointer(a,b){var c=b.getState().lock;if(!c){b.getState().canMoveRingPointer=!0;return!1}}function touchMoveRingPointer(a,b){var d,e,f,g,h,j,k,l,m,n,o,p,r,c=b.getState().lock;if(!c){d=b.getState();if(d.canMoveRingPointer){e=a.touches[0];f=getCanvasDataset(b);g=e.clientX-f.containerRect.left;h=e.clientY-f.containerRect.top;b.selectComponent("#"+a.currentTarget.id);j=inRingRectArea({x:g,y:h},b);if(j.in){k=f.containerRect.center;l=g-k.x;m=h-k.y;n=Math.atan2(m,l);o=n*H_DIV_PI;o>360&&(o-=360);0>o&&(o+=360);p=b.getState().lastAngle;if(null==p)b.getState().lastAngle=o;else{Math.abs(p-o);b.getState().lastAngle=o}r=d.lastColor;r.h!=o&&changeColorValue({h:o,s:r.s,v:r.v,t:r.t},b,!0)}else d.canMoveRingPointer=!1;return!1}}}function changeColorValue(a,b,c){var l,m,n,o,p,q,r,s,t,d=b.getState(),e=d.lastColor,f=b.selectComponent(mainContainerId),g=b.selectComponent(ringPointerId),h=f.getDataset(),i=h.containerRect,j=h.ringRadius,k=h.showOpacity;"true"==k&&(k=!0);"false"==k&&(k=!1);if(null==e){d.lastColor=a;if(c)b.requestAnimationFrame(function(){setRingPointerPosition(d.lastColor.h,g,j,i.center);setCenterViewColor(b);setSliderColor(b);updateSliderPointerPosition(b,"s");updateSliderPointerPosition(b,"v");k&&updateSliderPointerPosition(b,"t")});else{setRingPointerPosition(d.lastColor.h,g,j,i.center);setCenterViewColor(b);setSliderColor(b);updateSliderPointerPosition(b,"s");updateSliderPointerPosition(b,"v");k&&updateSliderPointerPosition(b,"t")}}else{l=e;if(a.h!=l.h||a.s!=l.s||a.v!=l.v||a.t!=l.t){if(a.h!=l.h||a.s!=l.s||a.v!=l.v){l.hex=hsv2rgb(l.h,l.s,l.v).hex;l.rawHex=hsv2rgb(l.h,1,1).hex}b.callMethod("colorChange",l);m=l.h;n=l.s;o=l.v;p=l.t;l.h=a.h;l.s=a.s;l.v=a.v;l.t=a.t;q=!1;r=!1;s=!1;t=!1;if(l.h!=m)if(c)b.requestAnimationFrame(function(){setRingPointerPosition(l.h,g,j,i.center);setCenterViewColor(b);setSliderColor(b);q=!0});else{setRingPointerPosition(l.h,g,j,i.center);setCenterViewColor(b);setSliderColor(b);q=!0}if(k&&l.t!=p)if(c)b.requestAnimationFrame(function(){updateSliderPointerPosition(b,"t");q||setCenterViewColor(b);r=!0;q=!0});else{updateSliderPointerPosition(b,"t");q||setCenterViewColor(b);r=!0;q=!0}if(l.s!=n)if(c)b.requestAnimationFrame(function(){updateSliderPointerPosition(b,"s");q||setCenterViewColor(b);s=!0;q=!0});else{updateSliderPointerPosition(b,"s");q||setCenterViewColor(b);s=!0;q=!0}if(l.v!=o)if(c)b.requestAnimationFrame(function(){updateSliderPointerPosition(b,"v");q||setCenterViewColor(b);t=!0;q=!0});else{updateSliderPointerPosition(b,"v");q||setCenterViewColor(b);t=!0;q=!0}}}}function _setSliderColor(a,b){var c=a.selectComponent("#slider-"+b),d=a.getState().lastColor,e="#ffffff";"v"==b&&(e="#000000");if("t"!=b)c.setStyle({"background-image":"linear-gradient(to right,"+d.rawHex+","+e+") !important"});else{e="rgba(255,255,255,0)";c.setStyle({"background-image":"linear-gradient(to right,"+d.rawHex+","+e+" 90%) !important"})}}function setSliderColor(a){var b,c;_setSliderColor(a,"s");_setSliderColor(a,"v");b=getCanvasDataset(a);c=b.showOpacity;"true"==c&&(c=!0);"false"==c&&(c=!1);c&&_setSliderColor(a,"t")}function setCenterViewColor(a){var b=a.getState().lastColor,c=a.selectComponent(centerViewId);c.setStyle({"background-color":b.hex+" !important",opacity:b.t+" !important"})}function propertyChangeWatcher(a,b,c){function n(){var b={};b.h=e.h+j;b.s=e.s+k;b.v=e.v+l;b.t=e.t+m;i++;if(i>=h){changeColorValue(a,c,!1);c.getState().lock=!1;c.callMethod("unLockEventTrigger")}else{changeColorValue(b,c,!1);c.requestAnimationFrame(n)}}var e,f,g,h,i,j,k,l,m;if(null!=a&&a!=b){null==a.hex&&(a.hex=hsv2rgb(a.h,a.s,a.v).hex);null==a.rawHex&&(a.rawHex=a.hex);e=c.getState().lastColor;if(null==e)changeColorValue(a,c,!0);else{if(null==a.h||null==a.s||null==a.v)return;f=getCanvasDataset(c);g=f.animationDuration;h=Math.floor(g/PFS);i=0;j=a.h-e.h;j/=h;k=a.s-e.s;k/=h;l=a.v-e.v;l/=h;m=a.t-e.t;m/=h;c.getState().lock=!0;c.callMethod("lockEventTrigger");n()}}}function setRingPointerPosition(a,b,c,d){var h,i,e=a*PI_DIV_180,f=b.getDataset(),g=f.radius;c-=7.05*c/200;h=Math.cos(e)*c+d.x;i=Math.sin(e)*c+d.y;h-=g;i-=g;b.setStyle({left:h+"px !important",top:i+"px !important",transform:"rotate("+a+"deg) !important"})}function inRingRectArea(a,b){var f,g,h,i,j,k,c=getCanvasDataset(b),d=getRingPointerDataset(b),e=c.ringRadius;e+=2*d.radius;f=c.containerRect.center;g=a.x-f.x;h=a.y-f.y;i=Math.atan2(h,g);j=g*g+h*h;k=!1;e*e>=j&&(k=!0);return{"in":k,angle:i*H_DIV_PI}}function inRingArea(a,b){var l,m,c=getCanvasDataset(b),d=getRingPointerDataset(b),e=c.ringRadius,f=c.containerRect.center,g=a.x-f.x,h=a.y-f.y,i=Math.atan2(h,g),j=g*g+h*h,k=e+2*d.radius;k*=k;l=e-d.radius;l*=l;m=!1;j>=l&&k>=j&&(m=!0);return{"in":m,angle:i*H_DIV_PI}}function pointInTheRegion(a,b,c,d,e){return a.x>b.x&&a.x>c.x&&a.x>d.x&&a.x>e.x?!1:a.x<b.x&&a.x<c.x&&a.x<d.x&&a.x<e.x?!1:a.y>b.y&&a.y>c.y&&a.y>d.y&&a.y>e.y?!1:a.y<b.y&&a.y<c.y&&a.y<d.y&&a.y<e.y?!1:!0}function hsv2rgb(a,b,c){var g,h,i,j,k,l,m,n,o,d=c*b,e=a/60,f=d*(1-Math.abs(e%2-1));e>=0&&1>=e?[g,h,i]=[d,f,0]:e>=1&&2>=e?[g,h,i]=[f,d,0]:e>=2&&3>=e?[g,h,i]=[0,d,f]:e>=3&&4>=e?[g,h,i]=[0,f,d]:e>=4&&5>=e?[g,h,i]=[f,0,d]:e>=5&&6>=e&&([g,h,i]=[d,0,f]);j=c-d;k=g+j;l=h+j;m=i+j;n=[Math.floor(255*k),Math.floor(255*l),Math.floor(255*m)];o=rgbToHex(n[0],n[1],n[2]);return{rgb:n,hex:o}}function componentToHex(a){var b=a.toString(16);return 1==b.length?"0"+b:b}function rgbToHex(a,b,c){return"#"+componentToHex(a)+componentToHex(b)+componentToHex(c)}function getSliderDataset(a,b){return a.selectComponent("#slider-"+b).getDataset()}function getCanvasDataset(a){return a.selectComponent(mainContainerId).getDataset()}function getRingPointerDataset(a){return a.selectComponent(ringPointerId).getDataset()}function moveView(a,b){var c=b.selectComponent("#"+a.currentTarget.id),d=a.touches[0];c.setStyle({left:d.clientX-50+"px !important",top:d.clientY-50+"px !important"})}var ringPointerId="#ring-pointer",centerViewId="#center-color-view",mainContainerId="#main-container",PFS=1000/60,PI_DIV_180=Math.PI/180,H_DIV_PI=180/Math.PI;module.exports={moveView:moveView,touchMoveSliderPointer:touchMoveSliderPointer,touchSliderPointer:touchSliderPointer,tapRingPointer:tapRingPointer,touchMoveRingPointer:touchMoveRingPointer,touchRingPointer:touchRingPointer,propertyChangeWatcher:propertyChangeWatcher};